let width = window.innerWidth;
let height = window.innerHeight;

let renderDiv = d3.select("#draw_area")
                  .style("width", width - 100);

let execEnrich = function(){
    let svg = d3.select("#enrich_svg");
    let table = d3.select("#enrich_table");
    let button = d3.select("#dl_button_div");
    let g = svg.selectAll(".forcegraph");
    if(g) g.remove();
    table.html("");
    button.html("");
    svg.attr("height", 100);
    let list = table.select("#enrich_list");
    if(list) list.remove();
    let data = document.getElementById("data").value;
    let target = document.getElementById("target").value;
    let thresh = document.getElementById("thresh").value;
    let param = jpostdb.slice_comparison.param;
    param.width = width - 100;
    param.graphHeight = height / 4 * 3;
    try {
      if(!data.match(/\w/)){
        throw new Error("no accession");
      }
      let url = "https://tools.jpostdb.org/api/enrich";
      let arg = "data=" + data + "&e=1&target=" + target + "&thresh=" + thresh;
      jpostdb.img_download.appendDlButton(d3.select("#dl_button_div"), d3.select("#enrich_svg"), "enrich_graph", false);
      jpostdb.fetchReq("post", url, arg, renderDiv, param.width, jpostdb.slice_comparison.enrichMap);
    } catch(e) {
      console.log(e.message);
    }
}

let panelCtrlSwitch = function(){
  if(panel_display){
    d3.select("#move_panel").attr("class", "fas fa-chevron-circle-right");
    panel_display = false;
  }else{
    d3.select("#move_panel").attr("class", "fas fa-chevron-circle-left");
    panel_display = true;
  }
}

d3.select("#submit")
  .on("click", function(){
    execEnrich();
  });

let panel_display = true;
d3.select("#move_panel")
  .on("click", function(){
    if(panel_display){
      d3.select("#panel").transition().delay(300).duration(1000).style("left", "-200px");
      setTimeout(panelCtrlSwitch, 1300);
    }else{
      d3.select("#panel").transition().delay(300).duration(1000).style("left", "80px");
      setTimeout(panelCtrlSwitch, 1300);
    }
  });

d3.select("#sample")
  .on("click", function(){
    document.getElementById("data").value = `P02751\nQ14764\nP24821\nQ9NZM1\nP12111\nQ6YHK3\nP08473\nP12110\nQ15582\nP35555\nQ9Y6N5\nQ6UVK1\nQ6NZI2\nP08123\nQ3SY69\nP08648\nQ12884\nQ9NZN3\nQ8IWE2\nQ9UKK3\nQ6EMK4\nQ96D15\nQ6PIU2\nP21980\nQ96CX2\nQ96CV9\nP07093\nP41219\nP17931\nQ9HBL0\nP26447\nP50416\nP02461\nQ8NEU8\nQ13425\nP53801\nQ9H4M9\nQ8WX93\nQ3KQV9\nQ4V9L6\nQ9UHL4\nP00533\nQ13443\nP35052\nQ9NX02\nP20810\nQ13976\nQ8WUH6\nO94804\nP08962\nO60826\nQ16134\nQ92508\nP50479\nQ86X83\nP30536\nO94919\nP13716\nP42226\nQ9UHQ9\nQ765P7\nQ96JY6\nP49441\nQ9C0H2\nP23743\nP80217\nQ9HD26\nQ9Y4D7\nQ9H173\nP51688\nQ6NYC8\nQ5EBL4\nO14495\nP21266\nQ13325\nQ9Y6I9\nQ96HD1\nO75962\nP51808\nQ08426\nQ03518\nQ7Z6B7\nQ96JC1\nQ709C8\nQ5HYC2\nQ5T0D9\nQ86UU1\nQ8N3D4\nQ567U6\nQ9H5N1\nO15230\nP49418\nQ9NVU7\nQ9Y6K9\nO14657\nO95070\nQ9Y5U8\nQ5T7P8\nP05121\nQ9NYL2\nP51531\nQ96BX8\nQ8IY95\nP51805\nQ9H7Z6\nQ6STE5\nQ86VM9\nQ96CM8\nP35475\nP81877\nP51553\nQ9NQS7\nQ9NRY6\nO43149\nQ8TB36\nP18433\nO75829\nQ9NX08\nQ8TEW0\nQ9Y4Z0\nO95785\nP49903\nQ6ZVM7\nA0A0B4J1V8\nQ13554\nQ96FZ7\nO15254\nQ68CQ7\nQ9Y2W6\nQ8NI60\nQ86YR5\nQ9BZL4\nP52435\nQ9BU61\nQ96MU7\nQ9HAN9\nQ0JRZ9\nO15182\nQ5TC12\nP05997\nQ9BVI4\nQ8WYB5\nQ6P9B9\nQ6P4F2\nP06681\nI6MBV4\nQ15007\nQ5T6V5\nQ9Y6R0\nP31751\nQ9NWZ8\nQ01831\nQ6P1M0\nQ9H9Y2\nQ8IWB9\nQ9P2G1\nO75695\nQ53FA7\nO14715\nQ9NX24\nP51798\nQ6P158\nQ9P0M9\nP11234\nQ9NZN5\nQ92947\nP19012\nQ15428\nA0A0A7KU15\nQ15836\nQ9Y221\nQ8WXA3\nQ9UG56\nQ8N357\nP14678\nQ92769\nQ14865\nO96004\nQ6UN15\nQ9BV38\nO96019\nQ9NP77\nQ9P0S9\nQ15532\nQ8WY07\nQ76I76\nQ13601\nP62834\nQ5VT25\nQ8WYA6\nQ9BXR0\nQ9ULR0\nQ96J02\nP05026\nP81133\nQ99459\nQ9P0U1\nQ9Y5A7\nA4UGR9\nO96008\nQ15233\nP18754\nP23434\nQ8TAQ2\nQ9UHA3\nQ9H3M7\nP0CZ25\nA7E2V4\nQ15119\nO43251\nQ8WTV0\nQ8NI77\nO14925\nP68431\nQ12981\nQ9BTC0\nQ9UK59\nQ14739\nQ9BRP8\nQ7L523\nQ01130\nP11182\nP62306\nQ9P0Z9\nQ9Y3D5\nQ9BYT8\nQ9H078\nO43818\nP52272\nQ9HAU5\nQ86Y46\nP62304\nQ9Y2X3\nQ15773\nP31483\nQ9Y5L4\nP17735\nQ9Y2Z4\nQ86Y79\nQ32MH5\nQ9NZJ5\nQ9UPP5\nQ9Y5U2\nQ96MM6\nQ5T655\nQ9BXM0\nQ9UIF8\nO00213\nQ15573\nP0CG40\nQ8WZA2\nQ8IZT6\nQ7Z589\nP35670\nQ9Y3T6\nA6NFT4\nQ9BXB1\nQ9H0W7\nP29375\nQ86UX7`;
});

d3.select("#sample2")
  .on("click", function(){
    document.getElementById("data").value = `P02751\t10.626\nQ14764\t9.4133\nP24821\t9.4122\nQ9NZM1\t9.3456\nP12111\t9.2874\nQ6YHK3\t8.8628\nP08473\t8.4169\nP12110\t8.4026\nQ15582\t8.0929\nP35555\t7.9731\nQ9Y6N5\t7.9682\nQ6UVK1\t7.8775\nQ6NZI2\t7.6455\nP08123\t7.5374\nQ3SY69\t7.4226\nP08648\t7.252\nQ12884\t7.006\nQ9NZN3\t6.9585\nQ8IWE2\t6.9\nQ9UKK3\t6.7781\nQ6EMK4\t6.6718\nQ96D15\t6.6402\nQ6PIU2\t6.5223\nP21980\t6.4098\nQ96CX2\t6.403\nQ96CV9\t6.3758\nP07093\t6.1666\nP41219\t6.1533\nP17931\t6.0846\nQ9HBL0\t6.0697\nP26447\t5.9618\nP50416\t5.7858\nP02461\t5.7812\nQ8NEU8\t5.7578\nQ13425\t5.7448\nP53801\t5.4735\nQ9H4M9\t5.4658\nQ8WX93\t5.4632\nQ3KQV9\t5.4129\nQ4V9L6\t5.4103\nQ9UHL4\t5.3983\nP00533\t5.316\nQ13443\t5.1797\nP35052\t5.1697\nQ9NX02\t-5.1655\nP20810\t5.1466\nQ13976\t5.1369\nQ8WUH6\t5.0706\nO94804\t5.0309\nP08962\t4.971\nO60826\t4.9558\nQ16134\t4.8896\nQ92508\t4.8691\nP50479\t4.8683\nQ86X83\t4.8284\nP30536\t4.8108\nO94919\t4.7685\nP13716\t4.7267\nP42226\t4.6919\nQ9UHQ9\t4.4784\nQ765P7\t4.4554\nQ96JY6\t4.3956\nP49441\t4.3849\nQ9C0H2\t4.3742\nP23743\t4.3207\nP80217\t4.3138\nQ9HD26\t4.3066\nQ9Y4D7\t4.3063\nQ9H173\t4.2772\nP51688\t4.2696\nQ6NYC8\t4.2534\nQ5EBL4\t4.2381\nO14495\t4.1865\nP21266\t4.1582\nQ13325\t4.1551\nQ9Y6I9\t4.1221\nQ96HD1\t4.0913\nO75962\t4.0571\nP51808\t4.0131\nQ08426\t4.0121\nQ03518\t3.9261\nQ7Z6B7\t3.8881\nQ96JC1\t3.849\nQ709C8\t3.8316\nQ5HYC2\t3.8074\nQ5T0D9\t3.7718\nQ86UU1\t3.7614\nQ8N3D4\t3.7332\nQ567U6\t3.6531\nQ9H5N1\t3.6356\nO15230\t-3.5988\nP49418\t3.5938\nQ9NVU7\t-3.5116\nQ9Y6K9\t3.5049\nO14657\t3.4946\nO95070\t3.4939\nQ9Y5U8\t3.4578\nQ5T7P8\t-3.4441\nP05121\t3.4382\nQ9NYL2\t3.435\nP51531\t-3.4153\nQ96BX8\t3.4048\nQ8IY95\t3.3999\nP51805\t3.3678\nQ9H7Z6\t-3.3361\nQ6STE5\t-3.3219\nQ86VM9\t-3.2738\nQ96CM8\t3.2665\nP35475\t3.2381\nP81877\t-3.1573\nP51553\t3.1097\nQ9NQS7\t-3.0889\nQ9NRY6\t3.0602\nO43149\t3.0358\nQ8TB36\t-2.9943\nP18433\t2.969\nO75829\t-2.911\nQ9NX08\t2.9096\nQ8TEW0\t-2.9007\nQ9Y4Z0\t-2.9002\nO95785\t-2.8927\nP49903\t-2.8885\nQ6ZVM7\t2.8884\nA0A0B4J1V8\t-2.8532\nQ13554\t2.8319\nQ96FZ7\t2.8306\nO15254\t2.8157\nQ68CQ7\t2.7974\nQ9Y2W6\t-2.7868\nQ8NI60\t-2.78\nQ86YR5\t2.7618\nQ9BZL4\t2.7474\nP52435\t-2.7225\nQ9BU61\t-2.721\nQ96MU7\t-2.7079\nQ9HAN9\t2.6356\nQ0JRZ9\t2.6208\nO15182\t-2.6092\nQ5TC12\t-2.5879\nP05997\t2.585\nQ9BVI4\t-2.5831\nQ8WYB5\t-2.5714\nQ6P9B9\t-2.5544\nQ6P4F2\t2.548\nP06681\t2.548\nI6MBV4\t2.5206\nQ15007\t-2.4943\nQ5T6V5\t2.4767\nQ9Y6R0\t2.4698\nP31751\t2.458\nQ9NWZ8\t-2.4534\nQ01831\t-2.4481\nQ6P1M0\t2.4433\nQ9H9Y2\t-2.4096\nQ8IWB9\t2.39\nQ9P2G1\t2.39\nO75695\t2.3701\nQ53FA7\t2.3597\nO14715\t-2.2712\nQ9NX24\t-2.2647\nP51798\t2.2583\nQ6P158\t-2.2516\nQ9P0M9\t-2.2378\nP11234\t2.2238\nQ9NZN5\t2.195\nQ92947\t-2.1831\nP19012\t-2.1633\nQ15428\t-2.1458\nA0A0A7KU15\t2.1425\nQ15836\t2.1256\nQ9Y221\t-2.118\nQ8WXA3\t2.1133\nQ9UG56\t-2.0805\nQ8N357\t2.0763\nP14678\t-2.039\nQ92769\t-2.0021\nQ14865\t2\nO96004\t1.9534\nQ6UN15\t-1.9484\nQ9BV38\t-1.9483\nO96019\t-1.9435\nQ9NP77\t-1.9352\nQ9P0S9\t-1.911\nQ15532\t-1.8962\nQ8WY07\t-1.8804\nQ76I76\t1.8617\nQ13601\t-1.8451\nP62834\t1.8166\nQ5VT25\t1.8061\nQ8WYA6\t-1.8001\nQ9BXR0\t-1.7863\nQ9ULR0\t-1.7823\nQ96J02\t1.7816\nP05026\t-1.7809\nP81133\t1.7233\nQ99459\t-1.7196\nQ9P0U1\t-1.7124\nQ9Y5A7\t-1.6962\nA4UGR9\t-1.6887\nO96008\t-1.6876\nQ15233\t-1.6833\nP18754\t-1.6705\nP23434\t-1.6484\nQ8TAQ2\t-1.6259\nQ9UHA3\t-1.6068\nQ9H3M7\t1.585\nP0CZ25\t-1.585\nA7E2V4\t1.585\nQ15119\t-1.585\nO43251\t-1.5819\nQ8WTV0\t1.5646\nQ8NI77\t-1.5425\nO14925\t-1.5219\nP68431\t-1.514\nQ12981\t1.5006\nQ9BTC0\t-1.4758\nQ9UK59\t-1.4518\nQ14739\t-1.4447\nQ9BRP8\t-1.4201\nQ7L523\t1.3799\nQ01130\t-1.323\nP11182\t-1.316\nP62306\t-1.2953\nQ9P0Z9\t-1.29\nQ9Y3D5\t-1.2608\nQ9BYT8\t-1.2603\nQ9H078\t-1.24\nO43818\t-1.2271\nP52272\t-1.2267\nQ9HAU5\t-1.215\nQ86Y46\t1.2093\nP62304\t-1.1991\nQ9Y2X3\t-1.1828\nQ15773\t-1.161\nP31483\t-1.1329\nQ9Y5L4\t-1.1072\nP17735\t-1.0805\nQ9Y2Z4\t-1.0436\nQ86Y79\t1\nQ32MH5\t-1\nQ9NZJ5\t-1\nQ9UPP5\t-1\nQ9Y5U2\t-1\nQ96MM6\t1\nQ5T655\t-1\nQ9BXM0\t-1\nQ9UIF8\t-1\nO00213\t-1\nQ15573\t-1\nP0CG40\t-1\nQ8WZA2\t1\nQ8IZT6\t1\nQ7Z589\t-1\nP35670\t1\nQ9Y3T6\t1\nA6NFT4\t1\nQ9BXB1\t-1\nQ9H0W7\t1\nP29375\t-1\nQ86UX7\t1`;
});
